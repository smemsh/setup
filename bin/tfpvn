#!/usr/bin/env bash
#
# tfpvn
#   work around terraform not supporting locals in destroy-time provisioner
#
# apparently is an accepted proposal but not implemented yet:
#   opentofu/opentofu/issues/1258
#

case ${1:?} in
(create) play=kubestrap args=(-e init=true);;
(update) play=kubestrap;;
(destroy) play=kubedel;;
(fluxinit) play=fluxstrap;;
esac

ansible-playbook "${args[@]}" -e nodename=${2:?} ~/${play:?}.yml
