#
# ipnet.yml
#   useful IP networking related stuff, several roles may find useful
#
# usage:
#   - supply 'host' var in extra args, or 'target' if not
#   - falls back on 'inventory_hostname'
#   - use include_var or vars_files (we have in global vars/ for ansrole)
#   - in doing so: get ip_* populated from inventory for that system
#
---

#
ip_referent:      '{{host | d(target | d(inventory_hostname))}}'

#
ip_host:          '{{hostvars[ip_referent].ipnet}}'
ip_domain:        '{{hostvars[ip_referent].domain}}'
ip_subdomain:     "{{ip_domain.split('.') | first}}"
ip_fqdn:          '{{ip_referent}}.{{ip_domain}}'

#
ip_address:       "{{ip_host | ansible.utils.ipaddr('address')}}"
ip_network:       "{{ip_host | ansible.utils.ipaddr('network')}}"
ip_netmask:       "{{ip_host | ansible.utils.ipaddr('netmask')}}"
ip_prefix:        "{{ip_host | ansible.utils.ipaddr('prefix')}}"
ip_broadcast:     "{{ip_host | ansible.utils.ipaddr('broadcast')}}"
ip_first:         "{{ip_host | ansible.utils.ipaddr('1')}}"
ip_last:          "{{ip_host | ansible.utils.ipaddr('-2')}}"
ip_gateway:       "{{ip_first | ansible.utils.ipaddr('address')}}"
ip_gateway_last:  "{{ip_last | ansible.utils.ipaddr('address')}}"
ip_cidrnet:       "{{ip_network}}/{{ip_prefix}}"
