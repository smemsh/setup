#
# kubernetes-relevant variables
# (these vars require 'nodename' to be set if referenced)
#
---

#
init_join_timeout: 420

#
plexname: "{{nodename | regex_findall('^[^\\d]+') | first}}"
kubeconfig: "{{playbook_dir}}/.kube/{{plexname}}.yml"

# n = third octet from the plex net's /22 base address
# pod cidr = 10.(n).0.0/16
# service cidr = 10.(n+1).0.0/16
# todo: this logic is duplicated in cloudinit.tftpl
#
plexnet: "{{nets_plex[plexname]}}"
octet3: "{{(plexnet | split('.'))[2] | int}}"
podnet: "{{'10.' + (octet3 | string) + '.0.0/16'}}"
srvnet: "{{'10.' + ((octet3 + 1) | string) + '.0.0/16'}}"

# temporary caching oci registry proxy to test how it affects speed
# single binary at https://github.com/distribution/distribution/releases/
#
ociurl: "{{plexname}}-oci:5000"

# todo: this is currently duplicated in terraform/
ocidepots:
  - ghcr
  - docker
  - gcr
  - registry.k8s
  - quay

# assert version when we bootstrap the data plane
version_flux: 2.7.3

# this is where we'll develop flux stuff for the moment TODO
flux_branch: fluxtest
