#
# ansible-role-ubunode
#   do basics that every ubuntu node gets after provisioning
#
# desc:
#   - timezone, locale, reserved uids/gids, sudoers, pams, umask, noskel
#
# may:
#   - ubunode_timezone
#   - ubunode_locale
#   - ubumode_umask
#   - ubunode_comment_files
#   - ubunode_comment_substrs
#
---

- name: display_phase
  debug:
    var: phase

- name: set_node_facts
  set_fact:
    is_debian: "{{(ansible_os_family | lower) == 'debian'}}"
    is_ubuntu: "{{(ansible_distribution | lower) == 'ubuntu'}}"
    is_physical: "{{ansible_virtualization_role == 'host'}}"
    is_container: "{{
      ansible_virtualization_role == 'guest' and
      ansible_virtualization_type == 'lxc'
    }}"
    u20plus: "{{
      ((ansible_distribution | lower) == 'ubuntu') and
      ((ansible_distribution_major_version | int) >= 20)
    }}"
    u24plus: "{{
      ((ansible_distribution | lower) == 'ubuntu') and
      ((ansible_distribution_major_version | int) >= 24)
    }}"

# TODO: we should maybe be a leaf role and not call other roles?

- name: run_custom_ssh_role
  include_role:
    name: ssh

- name: run_by_phase
  # todo: not sure why we need the full path, it doesn't seem to take
  # relative, not sure why
  include_tasks: "{{role_path}}/tasks/{{phase | d('operate')}}.yml"
